var background=function(){"use strict";var Rr,Ir;function $r(r){return r==null||typeof r=="function"?{main:r}:r}var O;(function(r){r.assertEqual=n=>n;function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{const i={};for(const a of n)i[a]=a;return i},r.getValidEnumValues=n=>{const i=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),a={};for(const o of i)a[o]=n[o];return r.objectValues(a)},r.objectValues=n=>r.objectKeys(n).map(function(i){return n[i]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&i.push(a);return i},r.find=(n,i)=>{for(const a of n)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=s,r.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(O||(O={}));var Lt;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Lt||(Lt={}));const y=O.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),X=r=>{switch(typeof r){case"undefined":return y.undefined;case"string":return y.string;case"number":return isNaN(r)?y.nan:y.number;case"boolean":return y.boolean;case"function":return y.function;case"bigint":return y.bigint;case"symbol":return y.symbol;case"object":return Array.isArray(r)?y.array:r===null?y.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?y.promise:typeof Map<"u"&&r instanceof Map?y.map:typeof Set<"u"&&r instanceof Set?y.set:typeof Date<"u"&&r instanceof Date?y.date:y.object;default:return y.unknown}},p=O.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Lr=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class z extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},s={_errors:[]},n=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(n);else if(a.code==="invalid_return_type")n(a.returnTypeError);else if(a.code==="invalid_arguments")n(a.argumentsError);else if(a.path.length===0)s._errors.push(t(a));else{let o=s,c=0;for(;c<a.path.length;){const l=a.path[c];c===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(a))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),s}static assert(e){if(!(e instanceof z))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,O.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}z.create=r=>new z(r);const Te=(r,e)=>{let t;switch(r.code){case p.invalid_type:r.received===y.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case p.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,O.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:t=`Unrecognized key(s) in object: ${O.joinValues(r.keys,", ")}`;break;case p.invalid_union:t="Invalid input";break;case p.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${O.joinValues(r.options)}`;break;case p.invalid_enum_value:t=`Invalid enum value. Expected ${O.joinValues(r.options)}, received '${r.received}'`;break;case p.invalid_arguments:t="Invalid function arguments";break;case p.invalid_return_type:t="Invalid function return type";break;case p.invalid_date:t="Invalid date";break;case p.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:O.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case p.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case p.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case p.custom:t="Invalid input";break;case p.invalid_intersection_types:t="Intersection results could not be merged";break;case p.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case p.not_finite:t="Number must be finite";break;default:t=e.defaultError,O.assertNever(r)}return{message:t}};let ms=Te;function Nr(r){ms=r}function pt(){return ms}const mt=r=>{const{data:e,path:t,errorMaps:s,issueData:n}=r,i=[...t,...n.path||[]],a={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="";const c=s.filter(l=>!!l).slice().reverse();for(const l of c)o=l(a,{data:e,defaultError:o}).message;return{...n,path:i,message:o}},Dr=[];function g(r,e){const t=pt(),s=mt({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Te?void 0:Te].filter(n=>!!n)});r.common.issues.push(s)}class M{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const n of t){if(n.status==="aborted")return w;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const n of t){const i=await n.key,a=await n.value;s.push({key:i,value:a})}return M.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const n of t){const{key:i,value:a}=n;if(i.status==="aborted"||a.status==="aborted")return w;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||n.alwaysSet)&&(s[i.value]=a.value)}return{status:e.value,value:s}}}const w=Object.freeze({status:"aborted"}),xe=r=>({status:"dirty",value:r}),B=r=>({status:"valid",value:r}),Nt=r=>r.status==="aborted",Dt=r=>r.status==="dirty",pe=r=>r.status==="valid",Ze=r=>typeof Promise<"u"&&r instanceof Promise;function gt(r,e,t,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function gs(r,e,t,s,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}typeof SuppressedError=="function"&&SuppressedError;var _;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(_||(_={}));var ze,qe;class W{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const ys=(r,e)=>{if(pe(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new z(r.common.issues);return this._error=t,this._error}}};function S(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(a,o)=>{var c,l;const{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(c=u??s)!==null&&c!==void 0?c:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:o.defaultError}},description:n}}class T{get description(){return this._def.description}_getType(e){return X(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:X(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new M,ctx:{common:e.parent.common,data:e.data,parsedType:X(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ze(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const n={common:{issues:[],async:(s=t==null?void 0:t.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)},i=this._parseSync({data:e,path:n.path,parent:n});return ys(n,i)}"~validate"(e){var t,s;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:n});return pe(i)?{value:i.value}:{issues:n.common.issues}}catch(i){!((s=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||s===void 0)&&s.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(i=>pe(i)?{value:i.value}:{issues:n.common.issues})}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)},n=this._parse({data:e,path:s.path,parent:s}),i=await(Ze(n)?n:Promise.resolve(n));return ys(s,i)}refine(e,t){const s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,i)=>{const a=e(n),o=()=>i.addIssue({code:p.custom,...s(n)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new G({schema:this,typeName:b.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Y.create(this,this._def)}nullable(){return oe.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return J.create(this)}promise(){return je.create(this,this._def)}or(e){return He.create([this,e],this._def)}and(e){return We.create(this,e,this._def)}transform(e){return new G({...S(this._def),schema:this,typeName:b.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new et({...S(this._def),innerType:this,defaultValue:t,typeName:b.ZodDefault})}brand(){return new Bt({typeName:b.ZodBranded,type:this,...S(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new tt({...S(this._def),innerType:this,catchValue:t,typeName:b.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return st.create(this,e)}readonly(){return rt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ur=/^c[^\s-]{8,}$/i,Mr=/^[0-9a-z]+$/,Br=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Fr=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Zr=/^[a-z0-9_-]{21}$/i,zr=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,qr=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Vr=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Jr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ut;const Gr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Hr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Wr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Kr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Yr=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Qr=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,_s="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Xr=new RegExp(`^${_s}$`);function vs(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function en(r){return new RegExp(`^${vs(r)}$`)}function bs(r){let e=`${_s}T${vs(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function tn(r,e){return!!((e==="v4"||!e)&&Gr.test(r)||(e==="v6"||!e)&&Wr.test(r))}function sn(r,e){if(!zr.test(r))return!1;try{const[t]=r.split("."),s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function rn(r,e){return!!((e==="v4"||!e)&&Hr.test(r)||(e==="v6"||!e)&&Kr.test(r))}class V extends T{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==y.string){const i=this._getOrReturnCtx(e);return g(i,{code:p.invalid_type,expected:y.string,received:i.parsedType}),w}const s=new M;let n;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:p.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:p.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(n=this._getOrReturnCtx(e,n),a?g(n,{code:p.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&g(n,{code:p.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")Vr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"email",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Ut||(Ut=new RegExp(Jr,"u")),Ut.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"emoji",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")Fr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"uuid",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Zr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"nanoid",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")Ur.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cuid",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")Mr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cuid2",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Br.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"ulid",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),g(n,{validation:"url",code:p.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"regex",code:p.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?bs(i).test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?Xr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?en(i).test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?qr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"duration",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?tn(e.data,i.version)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"ip",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?sn(e.data,i.alg)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"jwt",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?rn(e.data,i.version)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cidr",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Yr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"base64",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?Qr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"base64url",code:p.invalid_string,message:i.message}),s.dirty()):O.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(n=>e.test(n),{validation:t,code:p.invalid_string,..._.errToObj(s)})}_addCheck(e){return new V({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",..._.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",..._.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",..._.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,..._.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,..._.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",..._.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,..._.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,..._.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,..._.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,..._.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,..._.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,..._.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,..._.errToObj(t)})}nonempty(e){return this.min(1,_.errToObj(e))}trim(){return new V({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new V({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new V({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}V.create=r=>{var e;return new V({checks:[],typeName:b.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...S(r)})};function nn(r,e){const t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,i=parseInt(r.toFixed(n).replace(".","")),a=parseInt(e.toFixed(n).replace(".",""));return i%a/Math.pow(10,n)}class ne extends T{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==y.number){const i=this._getOrReturnCtx(e);return g(i,{code:p.invalid_type,expected:y.number,received:i.parsedType}),w}let s;const n=new M;for(const i of this._def.checks)i.kind==="int"?O.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:p.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?nn(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:p.not_finite,message:i.message}),n.dirty()):O.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,s,n){return new ne({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:_.toString(n)}]})}_addCheck(e){return new ne({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:_.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&O.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ne.create=r=>new ne({checks:[],typeName:b.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...S(r)});class ie extends T{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==y.bigint)return this._getInvalidInput(e);let s;const n=new M;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):O.assertNever(i);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return g(t,{code:p.invalid_type,expected:y.bigint,received:t.parsedType}),w}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,s,n){return new ie({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:_.toString(n)}]})}_addCheck(e){return new ie({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ie.create=r=>{var e;return new ie({checks:[],typeName:b.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...S(r)})};class Ve extends T{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==y.boolean){const s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:y.boolean,received:s.parsedType}),w}return B(e.data)}}Ve.create=r=>new Ve({typeName:b.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...S(r)});class me extends T{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==y.date){const i=this._getOrReturnCtx(e);return g(i,{code:p.invalid_type,expected:y.date,received:i.parsedType}),w}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return g(i,{code:p.invalid_date}),w}const s=new M;let n;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:p.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:p.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):O.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new me({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:_.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:_.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}me.create=r=>new me({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:b.ZodDate,...S(r)});class yt extends T{_parse(e){if(this._getType(e)!==y.symbol){const s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:y.symbol,received:s.parsedType}),w}return B(e.data)}}yt.create=r=>new yt({typeName:b.ZodSymbol,...S(r)});class Je extends T{_parse(e){if(this._getType(e)!==y.undefined){const s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:y.undefined,received:s.parsedType}),w}return B(e.data)}}Je.create=r=>new Je({typeName:b.ZodUndefined,...S(r)});class Ge extends T{_parse(e){if(this._getType(e)!==y.null){const s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:y.null,received:s.parsedType}),w}return B(e.data)}}Ge.create=r=>new Ge({typeName:b.ZodNull,...S(r)});class Ee extends T{constructor(){super(...arguments),this._any=!0}_parse(e){return B(e.data)}}Ee.create=r=>new Ee({typeName:b.ZodAny,...S(r)});class ge extends T{constructor(){super(...arguments),this._unknown=!0}_parse(e){return B(e.data)}}ge.create=r=>new ge({typeName:b.ZodUnknown,...S(r)});class ee extends T{_parse(e){const t=this._getOrReturnCtx(e);return g(t,{code:p.invalid_type,expected:y.never,received:t.parsedType}),w}}ee.create=r=>new ee({typeName:b.ZodNever,...S(r)});class _t extends T{_parse(e){if(this._getType(e)!==y.undefined){const s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:y.void,received:s.parsedType}),w}return B(e.data)}}_t.create=r=>new _t({typeName:b.ZodVoid,...S(r)});class J extends T{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==y.array)return g(t,{code:p.invalid_type,expected:y.array,received:t.parsedType}),w;if(n.exactLength!==null){const a=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(a||o)&&(g(t,{code:a?p.too_big:p.too_small,minimum:o?n.exactLength.value:void 0,maximum:a?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(g(t,{code:p.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(g(t,{code:p.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>n.type._parseAsync(new W(t,a,t.path,o)))).then(a=>M.mergeArray(s,a));const i=[...t.data].map((a,o)=>n.type._parseSync(new W(t,a,t.path,o)));return M.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new J({...this._def,minLength:{value:e,message:_.toString(t)}})}max(e,t){return new J({...this._def,maxLength:{value:e,message:_.toString(t)}})}length(e,t){return new J({...this._def,exactLength:{value:e,message:_.toString(t)}})}nonempty(e){return this.min(1,e)}}J.create=(r,e)=>new J({type:r,minLength:null,maxLength:null,exactLength:null,typeName:b.ZodArray,...S(e)});function Ae(r){if(r instanceof I){const e={};for(const t in r.shape){const s=r.shape[t];e[t]=Y.create(Ae(s))}return new I({...r._def,shape:()=>e})}else return r instanceof J?new J({...r._def,type:Ae(r.element)}):r instanceof Y?Y.create(Ae(r.unwrap())):r instanceof oe?oe.create(Ae(r.unwrap())):r instanceof K?K.create(r.items.map(e=>Ae(e))):r}class I extends T{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=O.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==y.object){const l=this._getOrReturnCtx(e);return g(l,{code:p.invalid_type,expected:y.object,received:l.parsedType}),w}const{status:s,ctx:n}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof ee&&this._def.unknownKeys==="strip"))for(const l in n.data)a.includes(l)||o.push(l);const c=[];for(const l of a){const u=i[l],h=n.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new W(n,h,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof ee){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:n.data[u]}});else if(l==="strict")o.length>0&&(g(n,{code:p.unrecognized_keys,keys:o}),s.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of o){const h=n.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new W(n,h,n.path,u)),alwaysSet:u in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const h=await u.key,f=await u.value;l.push({key:h,value:f,alwaysSet:u.alwaysSet})}return l}).then(l=>M.mergeObjectSync(s,l)):M.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return _.errToObj,new I({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var n,i,a,o;const c=(a=(i=(n=this._def).errorMap)===null||i===void 0?void 0:i.call(n,t,s).message)!==null&&a!==void 0?a:s.defaultError;return t.code==="unrecognized_keys"?{message:(o=_.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new I({...this._def,unknownKeys:"strip"})}passthrough(){return new I({...this._def,unknownKeys:"passthrough"})}extend(e){return new I({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new I({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:b.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new I({...this._def,catchall:e})}pick(e){const t={};return O.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new I({...this._def,shape:()=>t})}omit(e){const t={};return O.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new I({...this._def,shape:()=>t})}deepPartial(){return Ae(this)}partial(e){const t={};return O.objectKeys(this.shape).forEach(s=>{const n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}),new I({...this._def,shape:()=>t})}required(e){const t={};return O.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof Y;)i=i._def.innerType;t[s]=i}}),new I({...this._def,shape:()=>t})}keyof(){return ws(O.objectKeys(this.shape))}}I.create=(r,e)=>new I({shape:()=>r,unknownKeys:"strip",catchall:ee.create(),typeName:b.ZodObject,...S(e)}),I.strictCreate=(r,e)=>new I({shape:()=>r,unknownKeys:"strict",catchall:ee.create(),typeName:b.ZodObject,...S(e)}),I.lazycreate=(r,e)=>new I({shape:r,unknownKeys:"strip",catchall:ee.create(),typeName:b.ZodObject,...S(e)});class He extends T{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function n(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new z(o.ctx.common.issues));return g(t,{code:p.invalid_union,unionErrors:a}),w}if(t.common.async)return Promise.all(s.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(n);{let i;const a=[];for(const c of s){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(c=>new z(c));return g(t,{code:p.invalid_union,unionErrors:o}),w}}get options(){return this._def.options}}He.create=(r,e)=>new He({options:r,typeName:b.ZodUnion,...S(e)});const te=r=>r instanceof Ye?te(r.schema):r instanceof G?te(r.innerType()):r instanceof Qe?[r.value]:r instanceof ae?r.options:r instanceof Xe?O.objectValues(r.enum):r instanceof et?te(r._def.innerType):r instanceof Je?[void 0]:r instanceof Ge?[null]:r instanceof Y?[void 0,...te(r.unwrap())]:r instanceof oe?[null,...te(r.unwrap())]:r instanceof Bt||r instanceof rt?te(r.unwrap()):r instanceof tt?te(r._def.innerType):[];class vt extends T{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==y.object)return g(t,{code:p.invalid_type,expected:y.object,received:t.parsedType}),w;const s=this.discriminator,n=t.data[s],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(g(t,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),w)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const n=new Map;for(const i of t){const a=te(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,i)}}return new vt({typeName:b.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...S(s)})}}function Mt(r,e){const t=X(r),s=X(e);if(r===e)return{valid:!0,data:r};if(t===y.object&&s===y.object){const n=O.objectKeys(e),i=O.objectKeys(r).filter(o=>n.indexOf(o)!==-1),a={...r,...e};for(const o of i){const c=Mt(r[o],e[o]);if(!c.valid)return{valid:!1};a[o]=c.data}return{valid:!0,data:a}}else if(t===y.array&&s===y.array){if(r.length!==e.length)return{valid:!1};const n=[];for(let i=0;i<r.length;i++){const a=r[i],o=e[i],c=Mt(a,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===y.date&&s===y.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class We extends T{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=(i,a)=>{if(Nt(i)||Nt(a))return w;const o=Mt(i.value,a.value);return o.valid?((Dt(i)||Dt(a))&&t.dirty(),{status:t.value,value:o.data}):(g(s,{code:p.invalid_intersection_types}),w)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,a])=>n(i,a)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}We.create=(r,e,t)=>new We({left:r,right:e,typeName:b.ZodIntersection,...S(t)});class K extends T{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==y.array)return g(s,{code:p.invalid_type,expected:y.array,received:s.parsedType}),w;if(s.data.length<this._def.items.length)return g(s,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),w;!this._def.rest&&s.data.length>this._def.items.length&&(g(s,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...s.data].map((a,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new W(s,a,s.path,o)):null}).filter(a=>!!a);return s.common.async?Promise.all(i).then(a=>M.mergeArray(t,a)):M.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new K({...this._def,rest:e})}}K.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new K({items:r,typeName:b.ZodTuple,rest:null,...S(e)})};class Ke extends T{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==y.object)return g(s,{code:p.invalid_type,expected:y.object,received:s.parsedType}),w;const n=[],i=this._def.keyType,a=this._def.valueType;for(const o in s.data)n.push({key:i._parse(new W(s,o,s.path,o)),value:a._parse(new W(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?M.mergeObjectAsync(t,n):M.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof T?new Ke({keyType:e,valueType:t,typeName:b.ZodRecord,...S(s)}):new Ke({keyType:V.create(),valueType:e,typeName:b.ZodRecord,...S(t)})}}class bt extends T{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==y.map)return g(s,{code:p.invalid_type,expected:y.map,received:s.parsedType}),w;const n=this._def.keyType,i=this._def.valueType,a=[...s.data.entries()].map(([o,c],l)=>({key:n._parse(new W(s,o,s.path,[l,"key"])),value:i._parse(new W(s,c,s.path,[l,"value"]))}));if(s.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of a){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return w;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of a){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return w;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}}}}bt.create=(r,e,t)=>new bt({valueType:e,keyType:r,typeName:b.ZodMap,...S(t)});class ye extends T{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==y.set)return g(s,{code:p.invalid_type,expected:y.set,received:s.parsedType}),w;const n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(g(s,{code:p.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(g(s,{code:p.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const i=this._def.valueType;function a(c){const l=new Set;for(const u of c){if(u.status==="aborted")return w;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const o=[...s.data.values()].map((c,l)=>i._parse(new W(s,c,s.path,l)));return s.common.async?Promise.all(o).then(c=>a(c)):a(o)}min(e,t){return new ye({...this._def,minSize:{value:e,message:_.toString(t)}})}max(e,t){return new ye({...this._def,maxSize:{value:e,message:_.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ye.create=(r,e)=>new ye({valueType:r,minSize:null,maxSize:null,typeName:b.ZodSet,...S(e)});class Oe extends T{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==y.function)return g(t,{code:p.invalid_type,expected:y.function,received:t.parsedType}),w;function s(o,c){return mt({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,pt(),Te].filter(l=>!!l),issueData:{code:p.invalid_arguments,argumentsError:c}})}function n(o,c){return mt({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,pt(),Te].filter(l=>!!l),issueData:{code:p.invalid_return_type,returnTypeError:c}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof je){const o=this;return B(async function(...c){const l=new z([]),u=await o._def.args.parseAsync(c,i).catch(m=>{throw l.addIssue(s(c,m)),l}),h=await Reflect.apply(a,this,u);return await o._def.returns._def.type.parseAsync(h,i).catch(m=>{throw l.addIssue(n(h,m)),l})})}else{const o=this;return B(function(...c){const l=o._def.args.safeParse(c,i);if(!l.success)throw new z([s(c,l.error)]);const u=Reflect.apply(a,this,l.data),h=o._def.returns.safeParse(u,i);if(!h.success)throw new z([n(u,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Oe({...this._def,args:K.create(e).rest(ge.create())})}returns(e){return new Oe({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new Oe({args:e||K.create([]).rest(ge.create()),returns:t||ge.create(),typeName:b.ZodFunction,...S(s)})}}class Ye extends T{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ye.create=(r,e)=>new Ye({getter:r,typeName:b.ZodLazy,...S(e)});class Qe extends T{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return g(t,{received:t.data,code:p.invalid_literal,expected:this._def.value}),w}return{status:"valid",value:e.data}}get value(){return this._def.value}}Qe.create=(r,e)=>new Qe({value:r,typeName:b.ZodLiteral,...S(e)});function ws(r,e){return new ae({values:r,typeName:b.ZodEnum,...S(e)})}class ae extends T{constructor(){super(...arguments),ze.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return g(t,{expected:O.joinValues(s),received:t.parsedType,code:p.invalid_type}),w}if(gt(this,ze)||gs(this,ze,new Set(this._def.values)),!gt(this,ze).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return g(t,{received:t.data,code:p.invalid_enum_value,options:s}),w}return B(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ae.create(e,{...this._def,...t})}exclude(e,t=this._def){return ae.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}}ze=new WeakMap,ae.create=ws;class Xe extends T{constructor(){super(...arguments),qe.set(this,void 0)}_parse(e){const t=O.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==y.string&&s.parsedType!==y.number){const n=O.objectValues(t);return g(s,{expected:O.joinValues(n),received:s.parsedType,code:p.invalid_type}),w}if(gt(this,qe)||gs(this,qe,new Set(O.getValidEnumValues(this._def.values))),!gt(this,qe).has(e.data)){const n=O.objectValues(t);return g(s,{received:s.data,code:p.invalid_enum_value,options:n}),w}return B(e.data)}get enum(){return this._def.values}}qe=new WeakMap,Xe.create=(r,e)=>new Xe({values:r,typeName:b.ZodNativeEnum,...S(e)});class je extends T{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==y.promise&&t.common.async===!1)return g(t,{code:p.invalid_type,expected:y.promise,received:t.parsedType}),w;const s=t.parsedType===y.promise?t.data:Promise.resolve(t.data);return B(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}}je.create=(r,e)=>new je({type:r,typeName:b.ZodPromise,...S(e)});class G extends T{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===b.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:a=>{g(s,a),a.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const a=n.transform(s.data,i);if(s.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return w;const c=await this._def.schema._parseAsync({data:o,path:s.path,parent:s});return c.status==="aborted"?w:c.status==="dirty"||t.value==="dirty"?xe(c.value):c});{if(t.value==="aborted")return w;const o=this._def.schema._parseSync({data:a,path:s.path,parent:s});return o.status==="aborted"?w:o.status==="dirty"||t.value==="dirty"?xe(o.value):o}}if(n.type==="refinement"){const a=o=>{const c=n.refinement(o,i);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?w:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?w:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!pe(a))return a;const o=n.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>pe(a)?Promise.resolve(n.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);O.assertNever(n)}}G.create=(r,e,t)=>new G({schema:r,typeName:b.ZodEffects,effect:e,...S(t)}),G.createWithPreprocess=(r,e,t)=>new G({schema:e,effect:{type:"preprocess",transform:r},typeName:b.ZodEffects,...S(t)});class Y extends T{_parse(e){return this._getType(e)===y.undefined?B(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Y.create=(r,e)=>new Y({innerType:r,typeName:b.ZodOptional,...S(e)});class oe extends T{_parse(e){return this._getType(e)===y.null?B(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}oe.create=(r,e)=>new oe({innerType:r,typeName:b.ZodNullable,...S(e)});class et extends T{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===y.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}et.create=(r,e)=>new et({innerType:r,typeName:b.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...S(e)});class tt extends T{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Ze(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new z(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new z(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}tt.create=(r,e)=>new tt({innerType:r,typeName:b.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...S(e)});class wt extends T{_parse(e){if(this._getType(e)!==y.nan){const s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:y.nan,received:s.parsedType}),w}return{status:"valid",value:e.data}}}wt.create=r=>new wt({typeName:b.ZodNaN,...S(r)});const an=Symbol("zod_brand");class Bt extends T{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class st extends T{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?w:i.status==="dirty"?(t.dirty(),xe(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?w:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new st({in:e,out:t,typeName:b.ZodPipeline})}}class rt extends T{_parse(e){const t=this._def.innerType._parse(e),s=n=>(pe(n)&&(n.value=Object.freeze(n.value)),n);return Ze(t)?t.then(n=>s(n)):s(t)}unwrap(){return this._def.innerType}}rt.create=(r,e)=>new rt({innerType:r,typeName:b.ZodReadonly,...S(e)});function ks(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Ss(r,e={},t){return r?Ee.create().superRefine((s,n)=>{var i,a;const o=r(s);if(o instanceof Promise)return o.then(c=>{var l,u;if(!c){const h=ks(e,s),f=(u=(l=h.fatal)!==null&&l!==void 0?l:t)!==null&&u!==void 0?u:!0;n.addIssue({code:"custom",...h,fatal:f})}});if(!o){const c=ks(e,s),l=(a=(i=c.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0;n.addIssue({code:"custom",...c,fatal:l})}}):Ee.create()}const on={object:I.lazycreate};var b;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(b||(b={}));const cn=(r,e={message:`Input not instance of ${r.name}`})=>Ss(t=>t instanceof r,e),Ts=V.create,xs=ne.create,ln=wt.create,un=ie.create,Es=Ve.create,dn=me.create,hn=yt.create,fn=Je.create,pn=Ge.create,mn=Ee.create,gn=ge.create,yn=ee.create,_n=_t.create,vn=J.create,bn=I.create,wn=I.strictCreate,kn=He.create,Sn=vt.create,Tn=We.create,xn=K.create,En=Ke.create,An=bt.create,On=ye.create,jn=Oe.create,Pn=Ye.create,Cn=Qe.create,Rn=ae.create,In=Xe.create,$n=je.create,As=G.create,Ln=Y.create,Nn=oe.create,Dn=G.createWithPreprocess,Un=st.create;var d=Object.freeze({__proto__:null,defaultErrorMap:Te,setErrorMap:Nr,getErrorMap:pt,makeIssue:mt,EMPTY_PATH:Dr,addIssueToContext:g,ParseStatus:M,INVALID:w,DIRTY:xe,OK:B,isAborted:Nt,isDirty:Dt,isValid:pe,isAsync:Ze,get util(){return O},get objectUtil(){return Lt},ZodParsedType:y,getParsedType:X,ZodType:T,datetimeRegex:bs,ZodString:V,ZodNumber:ne,ZodBigInt:ie,ZodBoolean:Ve,ZodDate:me,ZodSymbol:yt,ZodUndefined:Je,ZodNull:Ge,ZodAny:Ee,ZodUnknown:ge,ZodNever:ee,ZodVoid:_t,ZodArray:J,ZodObject:I,ZodUnion:He,ZodDiscriminatedUnion:vt,ZodIntersection:We,ZodTuple:K,ZodRecord:Ke,ZodMap:bt,ZodSet:ye,ZodFunction:Oe,ZodLazy:Ye,ZodLiteral:Qe,ZodEnum:ae,ZodNativeEnum:Xe,ZodPromise:je,ZodEffects:G,ZodTransformer:G,ZodOptional:Y,ZodNullable:oe,ZodDefault:et,ZodCatch:tt,ZodNaN:wt,BRAND:an,ZodBranded:Bt,ZodPipeline:st,ZodReadonly:rt,custom:Ss,Schema:T,ZodSchema:T,late:on,get ZodFirstPartyTypeKind(){return b},coerce:{string:r=>V.create({...r,coerce:!0}),number:r=>ne.create({...r,coerce:!0}),boolean:r=>Ve.create({...r,coerce:!0}),bigint:r=>ie.create({...r,coerce:!0}),date:r=>me.create({...r,coerce:!0})},any:mn,array:vn,bigint:un,boolean:Es,date:dn,discriminatedUnion:Sn,effect:As,enum:Rn,function:jn,instanceof:cn,intersection:Tn,lazy:Pn,literal:Cn,map:An,nan:ln,nativeEnum:In,never:yn,null:pn,nullable:Nn,number:xs,object:bn,oboolean:()=>Es().optional(),onumber:()=>xs().optional(),optional:Ln,ostring:()=>Ts().optional(),pipeline:Un,preprocess:Dn,promise:$n,record:En,set:On,strictObject:wn,string:Ts,symbol:hn,transformer:As,tuple:xn,undefined:fn,union:kn,unknown:gn,void:_n,NEVER:w,ZodIssueCode:p,quotelessJson:Lr,ZodError:z});const Mn=d.object({id:d.string().uuid(),lastSync:d.string().datetime({offset:!0})}),Ft=d.object({keywords:d.string().trim().toLowerCase().min(1,"Keyword cannot be empty.").transform(r=>r.replace(/[^\w\s]/g,"")).array().min(1),ignore:d.string().array().optional(),key:d.string(),appearances:d.coerce.number(),response:d.string().trim().min(1,"Response cannot be empty."),fromAutofill:d.boolean().default(!1),question:d.string().optional(),id:d.string().uuid().optional()}),Bn=d.array(Ft),Fn=["Bachelor's","Master's","MBA","PhD","PharmD","Associate's","High School","GED","Other"],Zn=["Afrikaans","Akan","Albanian","Amharic","Arabic","Armenian","Assamese","Azerbaijani","Basque","Belarusian","Bengali","Bhojpuri","Bosnian","Bulgarian","Burmese","Cantonese","Catalan","Cebuano","Chinese","Croatian","Czech","Danish","Dari","Dutch","Dzongkha","English","Estonian","Farsi","Finnish","French","Gaelic","Galician","Georgian","German","Greek","Gujarati","Haitian","Hakka","Hausa","Hebrew","Hiligaynon","Hindi","Hmong","Hungarian","Icelandic","Igbo","Ilokano","Indonesian","Irish","Italian","Japanese","Kannada","Kazakh","Khmer","Kirundi","Konkani","Korean","Kurdish","Kyrgyz","Lao","Latin","Latvian","Lithuanian","Macedonian","Maithili","Malagasy","Malay","Malay/Indonesian","Malayalam","Maltese","Mandarin","Marathi","Marwari","Min Nan","Mongolian","Nepali","Norwegian","Oriya","Pashto","Persian","Polish","Portuguese","Punjabi","Quechua","Romanian","Russian","Serbian","Serbo-Croatian","Shona","Sindhi","Sinhala","Slovak","Slovene","Somali","Spanish","Sundanese","Swahili","Swedish","Tagalog","Tagalog-Filipino","Tajik","Tamil","Telugu","Thai","Tibetan","Turkish","Turkmen","Uighur","Ukrainian","Urdu","Uzbek","Vietnamese","Xhosa","Yoruba","Zulu"],zn=["Beginner","Intermediate","Advanced","Full Professional Proficiency","Native"],qn=["Male","Female","Non-Binary","I choose not to disclose"],Vn=["American Indian or Alaska Native","Asian","Black or African American","Hispanic or Latino","Native Hawaiian or Other Pacific Islander","White","I choose not to disclose"],Jn=["Afghanistan","land Islands","Albania","Algeria","American Samoa","Andorra","Angola","Anguilla","Antigua and Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bonaire, Sint Eustatius, and Saba","Bosnia and Herzegovina","Botswana","Bouvet Island","Brazil","British Indian Ocean Territory","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Cayman Islands","Central African Republic","Chad","Chile","China","Christmas Island","Cocos (Keeling) Islands","Colombia","Comoros","Congo","Congo, Democratic Republic of the","Cook Islands","Costa Rica","Cte d'Ivoire","Croatia","Cuba","Curaao","Cyprus","Czechia","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Falkland Islands","Faroe Islands","Fiji","Finland","France","French Guiana","French Polynesia","French Southern Territories","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guadeloupe","Guam","Guatemala","Guernsey","Guinea","Guinea-Bissau","Guyana","Haiti","Heard Island and McDonald Islands","Holy See (Vatican City State)","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Korea, Democratic People's Republic of","Korea, Republic of","Kosovo","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macao","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Martinique","Mauritania","Mauritius","Mayotte","Mexico","Micronesia, Federated States of","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Niue","Norfolk Island","Northern Mariana Islands","North Macedonia","Norway","Oman","Pakistan","Palau","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Pitcairn Islands","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russian Federation","Rwanda","Saint Barthelemy","Saint Helena, Ascension and Tristan da Cunha","Saint Kitts and Nevis","Saint Lucia","Saint Martin","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Sint Maarten","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Georgia and the South Sandwich Islands","South Sudan","Spain","Sri Lanka","State of Palestine","Sudan","Suriname","Svalbard and Jan Mayen","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Timor-Leste","Togo","Tokelau","Tonga","Trinidad and Tobago","Tunisia","Trkiye","Turkmenistan","Turks and Caicos Islands","Tuvalu","U. S. Virgin Islands","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States Minor Outlying Islands","United States of America","Uruguay","Uzbekistan","Vanuatu","Venezuela","Vietnam","Wallis and Futuna","Western Sahara","Yemen","Zambia","Zimbabwe"],Gn=d.object({language:d.enum(["",...Zn]),fluent:d.boolean(),proficiency:d.enum(["",...zn])}),Hn=d.object({school:d.string(),degree:d.enum(["",...Fn]),fieldOfStudy:d.string(),startDate:d.string().optional(),currentlyAttending:d.boolean(),endDate:d.string().optional(),gpa:d.string().optional()}),Wn=d.object({jobTitle:d.string(),company:d.string(),location:d.string(),startDate:d.string(),currentlyWorkHere:d.boolean(),endDate:d.string().optional(),description:d.string()}),Kn=d.object({line1:d.string(),line2:d.string().optional(),city:d.string(),state:d.string(),postalCode:d.string(),country:d.enum(["",...Jn])}),Yn=d.object({phoneDeviceType:d.string(),phoneCountryCode:d.string(),phoneNumber:d.string(),email:d.string()}),Qn=d.object({prefix:d.string().optional(),firstName:d.string(),middleName:d.string().optional(),lastName:d.string(),suffix:d.string().optional(),preferredName:d.boolean(),preferredFirstName:d.string().optional(),preferredMiddleName:d.string().optional(),preferredLastName:d.string().optional()}),Xn=d.object({websites:d.array(d.string()),github:d.string().optional(),linkedin:d.string().optional(),twitter:d.string().optional(),personal:d.string().optional()}),ei=d.object({resumeBase64:d.string(),fileName:d.string(),fileSize:d.number(),dateUploaded:d.string()}),ti=d.object({eligibilityUS:d.union([d.boolean(),d.literal("undisclosed")]).optional(),sponsorship:d.union([d.boolean(),d.literal("undisclosed")]).optional(),disability:d.union([d.boolean(),d.literal("undisclosed")]).optional(),veteran:d.union([d.boolean(),d.literal("undisclosed")]).optional(),age:d.union([d.number(),d.literal("undisclosed")]).optional(),gender:d.enum(["",...qn]),ethnicity:d.enum(["",...Vn])}),nt=d.object({profileName:d.string().default("Default"),nameData:Qn,addressData:Kn,contactData:Yn,jobData:d.array(Wn),educationData:d.array(Hn),languageData:d.array(Gn),resumeData:ei,websiteData:Xn,employmentData:ti,skillsData:d.array(d.string()).max(25).optional(),savedResponses:d.preprocess(r=>{Ft.array().safeParse(r).success&&chrome.storage.local.set({responseList:r},()=>chrome.runtime.sendMessage({type:"syncNewResponses",data:r}))},d.undefined())});async function Os(){return new Promise(r=>chrome.storage.local.get(["profile"],e=>{try{r(nt.parse(e.profile))}catch{r(void 0)}}))}async function it(){return new Promise(r=>chrome.storage.local.get(["lastSyncProfile"],e=>{try{r(Mn.parse(e.lastSyncProfile))}catch{r(void 0)}}))}const Zt=d.enum(["applied","screen","interview","offer","rejected","archived"]),zt=d.object({jobTitle:d.string(),jobLink:d.string(),companyLink:d.string(),companyName:d.string().default(""),date:d.string(),status:Zt.default("applied"),profileName:d.string().default("Default"),id:d.string().uuid().optional()}),qt=d.array(zt);d.array(Zt).refine(r=>new Set(r).size===r.length).refine(r=>Object.values(Zt.enum).every(e=>r.includes(e)));const si=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ne).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Vt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class ri extends Vt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ni extends Vt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ii extends Vt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Jt;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Jt||(Jt={}));var ai=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class oi{constructor(e,{headers:t={},customFetch:s,region:n=Jt.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=si(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return ai(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let l;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=a):typeof a=="string"?(o["Content-Type"]="text/plain",l=a):typeof FormData<"u"&&a instanceof FormData?l=a:(o["Content-Type"]="application/json",l=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:l}).catch(v=>{throw new ri(v)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new ni(u);if(!u.ok)throw new ii(u);let f=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),m;return f==="application/json"?m=yield u.json():f==="application/octet-stream"?m=yield u.blob():f==="text/event-stream"?m=u:f==="multipart/form-data"?m=yield u.formData():m=yield u.text(),{data:m,error:null}}catch(n){return{data:null,error:n}}})}}function js(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function ci(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var n=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return r[s]}})}),t}var N={},Pe={},Ce={},Re={},Ie={},$e={},li=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Le=li();const ui=Le.fetch,Ps=Le.fetch.bind(Le),Cs=Le.Headers,di=Le.Request,hi=Le.Response,Ne=Object.freeze(Object.defineProperty({__proto__:null,Headers:Cs,Request:di,Response:hi,default:Ps,fetch:ui},Symbol.toStringTag,{value:"Module"})),fi=ci(Ne);var kt={},Rs;function Is(){if(Rs)return kt;Rs=1,Object.defineProperty(kt,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return kt.default=r,kt}var $s;function Ls(){if($s)return $e;$s=1;var r=$e&&$e.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty($e,"__esModule",{value:!0});const e=r(fi),t=r(Is());class s{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,a){return this.headers=Object.assign({},this.headers),this.headers[i]=a,this}then(i,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let c=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var u,h,f;let m=null,v=null,E=null,k=l.status,C=l.statusText;if(l.ok){if(this.method!=="HEAD"){const R=await l.text();R===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?v=R:v=JSON.parse(R))}const j=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),$=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");j&&$&&$.length>1&&(E=parseInt($[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(v)&&(v.length>1?(m={code:"PGRST116",details:`Results contain ${v.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},v=null,E=null,k=406,C="Not Acceptable"):v.length===1?v=v[0]:v=null)}else{const j=await l.text();try{m=JSON.parse(j),Array.isArray(m)&&l.status===404&&(v=[],m=null,k=200,C="OK")}catch{l.status===404&&j===""?(k=204,C="No Content"):m={message:j}}if(m&&this.isMaybeSingle&&(!((f=m==null?void 0:m.details)===null||f===void 0)&&f.includes("0 rows"))&&(m=null,k=200,C="OK"),m&&this.shouldThrowOnError)throw new t.default(m)}return{error:m,data:v,count:E,status:k,statusText:C}});return this.shouldThrowOnError||(c=c.catch(l=>{var u,h,f;return{error:{message:`${(u=l==null?void 0:l.name)!==null&&u!==void 0?u:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(h=l==null?void 0:l.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(f=l==null?void 0:l.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,a)}}return $e.default=s,$e}var Ns;function Ds(){if(Ns)return Ie;Ns=1;var r=Ie&&Ie.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ie,"__esModule",{value:!0});const e=r(Ls());class t extends e.default{select(n){let i=!1;const a=(n??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:i=!0,nullsFirst:a,foreignTable:o,referencedTable:c=o}={}){const l=c?`${c}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${n}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,i,{foreignTable:a,referencedTable:o=a}={}){const c=typeof o>"u"?"offset":`${o}.offset`,l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${n}`),this.url.searchParams.set(l,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:i=!1,settings:a=!1,buffers:o=!1,wal:c=!1,format:l="text"}={}){var u;const h=[n?"analyze":null,i?"verbose":null,a?"settings":null,o?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${f}"; options=${h};`,l==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Ie.default=t,Ie}var Us;function Gt(){if(Us)return Re;Us=1;var r=Re&&Re.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Re,"__esModule",{value:!0});const e=r(Ds());class t extends e.default{eq(n,i){return this.url.searchParams.append(n,`eq.${i}`),this}neq(n,i){return this.url.searchParams.append(n,`neq.${i}`),this}gt(n,i){return this.url.searchParams.append(n,`gt.${i}`),this}gte(n,i){return this.url.searchParams.append(n,`gte.${i}`),this}lt(n,i){return this.url.searchParams.append(n,`lt.${i}`),this}lte(n,i){return this.url.searchParams.append(n,`lte.${i}`),this}like(n,i){return this.url.searchParams.append(n,`like.${i}`),this}likeAllOf(n,i){return this.url.searchParams.append(n,`like(all).{${i.join(",")}}`),this}likeAnyOf(n,i){return this.url.searchParams.append(n,`like(any).{${i.join(",")}}`),this}ilike(n,i){return this.url.searchParams.append(n,`ilike.${i}`),this}ilikeAllOf(n,i){return this.url.searchParams.append(n,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(n,i){return this.url.searchParams.append(n,`ilike(any).{${i.join(",")}}`),this}is(n,i){return this.url.searchParams.append(n,`is.${i}`),this}in(n,i){const a=Array.from(new Set(i)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${a})`),this}contains(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cs.{${i.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(i)}`),this}containedBy(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cd.{${i.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(i)}`),this}rangeGt(n,i){return this.url.searchParams.append(n,`sr.${i}`),this}rangeGte(n,i){return this.url.searchParams.append(n,`nxl.${i}`),this}rangeLt(n,i){return this.url.searchParams.append(n,`sl.${i}`),this}rangeLte(n,i){return this.url.searchParams.append(n,`nxr.${i}`),this}rangeAdjacent(n,i){return this.url.searchParams.append(n,`adj.${i}`),this}overlaps(n,i){return typeof i=="string"?this.url.searchParams.append(n,`ov.${i}`):this.url.searchParams.append(n,`ov.{${i.join(",")}}`),this}textSearch(n,i,{config:a,type:o}={}){let c="";o==="plain"?c="pl":o==="phrase"?c="ph":o==="websearch"&&(c="w");const l=a===void 0?"":`(${a})`;return this.url.searchParams.append(n,`${c}fts${l}.${i}`),this}match(n){return Object.entries(n).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(n,i,a){return this.url.searchParams.append(n,`not.${i}.${a}`),this}or(n,{foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,i,a){return this.url.searchParams.append(n,`${i}.${a}`),this}}return Re.default=t,Re}var Ms;function Bs(){if(Ms)return Ce;Ms=1;var r=Ce&&Ce.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ce,"__esModule",{value:!0});const e=r(Gt());class t{constructor(n,{headers:i={},schema:a,fetch:o}){this.url=n,this.headers=i,this.schema=a,this.fetch=o}select(n,{head:i=!1,count:a}={}){const o=i?"HEAD":"GET";let c=!1;const l=(n??"*").split("").map(u=>/\s/.test(u)&&!c?"":(u==='"'&&(c=!c),u)).join("");return this.url.searchParams.set("select",l),a&&(this.headers.Prefer=`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:i,defaultToNull:a=!0}={}){const o="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),a||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(n)){const l=n.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(l.length>0){const u=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:i,ignoreDuplicates:a=!1,count:o,defaultToNull:c=!0}={}){const l="POST",u=[`resolution=${a?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),c||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(n)){const h=n.reduce((f,m)=>f.concat(Object.keys(m)),[]);if(h.length>0){const f=[...new Set(h)].map(m=>`"${m}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:i}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),this.headers.Prefer=o.join(","),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const i="DELETE",a=[];return n&&a.push(`count=${n}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Ce.default=t,Ce}var at={},ot={},Fs;function pi(){return Fs||(Fs=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.version=void 0,ot.version="0.0.0-automated"),ot}var Zs;function mi(){if(Zs)return at;Zs=1,Object.defineProperty(at,"__esModule",{value:!0}),at.DEFAULT_HEADERS=void 0;const r=pi();return at.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`},at}var zs;function gi(){if(zs)return Pe;zs=1;var r=Pe&&Pe.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Pe,"__esModule",{value:!0});const e=r(Bs()),t=r(Gt()),s=mi();class n{constructor(a,{headers:o={},schema:c,fetch:l}={}){this.url=a,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),o),this.schemaName=c,this.fetch=l}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new n(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:c=!1,get:l=!1,count:u}={}){let h;const f=new URL(`${this.url}/rpc/${a}`);let m;c||l?(h=c?"HEAD":"GET",Object.entries(o).filter(([E,k])=>k!==void 0).map(([E,k])=>[E,Array.isArray(k)?`{${k.join(",")}}`:`${k}`]).forEach(([E,k])=>{f.searchParams.append(E,k)})):(h="POST",m=o);const v=Object.assign({},this.headers);return u&&(v.Prefer=`count=${u}`),new t.default({method:h,url:f,headers:v,schema:this.schemaName,body:m,fetch:this.fetch,allowEmpty:!1})}}return Pe.default=n,Pe}var qs;function yi(){if(qs)return N;qs=1;var r=N&&N.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(N,"__esModule",{value:!0}),N.PostgrestError=N.PostgrestBuilder=N.PostgrestTransformBuilder=N.PostgrestFilterBuilder=N.PostgrestQueryBuilder=N.PostgrestClient=void 0;const e=r(gi());N.PostgrestClient=e.default;const t=r(Bs());N.PostgrestQueryBuilder=t.default;const s=r(Gt());N.PostgrestFilterBuilder=s.default;const n=r(Ds());N.PostgrestTransformBuilder=n.default;const i=r(Ls());N.PostgrestBuilder=i.default;const a=r(Is());return N.PostgrestError=a.default,N.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:a.default},N}var _i=yi();const vi=js(_i),{PostgrestClient:bi,PostgrestQueryBuilder:tc,PostgrestFilterBuilder:sc,PostgrestTransformBuilder:rc,PostgrestBuilder:nc,PostgrestError:ic}=vi,wi={"X-Client-Info":"realtime-js/2.11.2"},ki="1.0.0",Vs=1e4,Si=1e3;var De;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(De||(De={}));var q;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(q||(q={}));var H;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(H||(H={}));var Ht;(function(r){r.websocket="websocket"})(Ht||(Ht={}));var _e;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(_e||(_e={}));class Ti{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+n));a=a+n;const c=s.decode(e.slice(a,a+i));a=a+i;const l=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class Js{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var P;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(P||(P={}));const Gs=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=xi(a,r,e,n),i),{})},xi=(r,e,t,s)=>{const n=e.find(o=>o.name===r),i=n==null?void 0:n.type,a=t[r];return i&&!s.includes(i)?Hs(i,a):Wt(a)},Hs=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return ji(e,t)}switch(r){case P.bool:return Ei(e);case P.float4:case P.float8:case P.int2:case P.int4:case P.int8:case P.numeric:case P.oid:return Ai(e);case P.json:case P.jsonb:return Oi(e);case P.timestamp:return Pi(e);case P.abstime:case P.date:case P.daterange:case P.int4range:case P.int8range:case P.money:case P.reltime:case P.text:case P.time:case P.timestamptz:case P.timetz:case P.tsrange:case P.tstzrange:return Wt(e);default:return Wt(e)}},Wt=r=>r,Ei=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Ai=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Oi=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},ji=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Hs(e,o))}return r},Pi=r=>typeof r=="string"?r.replace(" ","T"):r,Ws=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Kt{constructor(e,t,s={},n=Vs){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ks;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Ks||(Ks={}));class ct{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ct.syncState(this.state,n,i,a),this.pendingDiffs.forEach(c=>{this.state=ct.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ct.syncDiff(this.state,n,i,a),o())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(l,u)=>{a[l]||(c[l]=u)}),this.map(a,(l,u)=>{const h=i[l];if(h){const f=u.map(k=>k.presence_ref),m=h.map(k=>k.presence_ref),v=u.filter(k=>m.indexOf(k.presence_ref)<0),E=h.filter(k=>f.indexOf(k.presence_ref)<0);v.length>0&&(o[l]=v),E.length>0&&(c[l]=E)}else o[l]=u}),this.syncDiff(i,{joins:o,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(o,c)=>{var l;const u=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),u.length>0){const h=e[o].map(m=>m.presence_ref),f=u.filter(m=>h.indexOf(m.presence_ref)<0);e[o].unshift(...f)}s(o,u,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=l,n(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ys;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ys||(Ys={}));var Qs;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Qs||(Qs={}));var se;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(se||(se={}));class Yt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Kt(this,H.join,this.params,this.timeout),this.rejoinTimer=new Js(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=q.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this._on(H.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new ct(this),this.broadcastEndpointURL=Ws(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:o}}=this.params;this._onError(u=>e==null?void 0:e(se.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(se.CLOSED));const c={},l={broadcast:i,presence:a,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&n!==void 0?n:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(se.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,m=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,v=[];for(let E=0;E<m;E++){const k=f[E],{filter:{event:C,schema:F,table:j,filter:$}}=k,R=u&&u[E];if(R&&R.event===C&&R.schema===F&&R.table===j&&R.filter===$)v.push(Object.assign(Object.assign({},k),{id:R.id}));else{this.unsubscribe(),e==null||e(se.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(se.SUBSCRIBED);return}}).receive("error",u=>{e==null||e(se.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(se.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=l.body)===null||n===void 0?void 0:n.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=q.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(H.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const n=new Kt(this,H.leave,{},e);n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Kt(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:u}=H;if(s&&[o,c,l,u].indexOf(a)>=0&&s!==this._joinRef())return;let f=this._onMessage(a,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(m=>{var v,E,k;return((v=m.filter)===null||v===void 0?void 0:v.event)==="*"||((k=(E=m.filter)===null||E===void 0?void 0:E.event)===null||k===void 0?void 0:k.toLocaleLowerCase())===a}).map(m=>m.callback(f,s)):(i=this.bindings[a])===null||i===void 0||i.filter(m=>{var v,E,k,C,F,j;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const $=m.id,R=(v=m.filter)===null||v===void 0?void 0:v.event;return $&&((E=t.ids)===null||E===void 0?void 0:E.includes($))&&(R==="*"||(R==null?void 0:R.toLocaleLowerCase())===((k=t.data)===null||k===void 0?void 0:k.type.toLocaleLowerCase()))}else{const $=(F=(C=m==null?void 0:m.filter)===null||C===void 0?void 0:C.event)===null||F===void 0?void 0:F.toLocaleLowerCase();return $==="*"||$===((j=t==null?void 0:t.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof f=="object"&&"ids"in f){const v=f.data,{schema:E,table:k,commit_timestamp:C,type:F,errors:j}=v;f=Object.assign(Object.assign({},{schema:E,table:k,commit_timestamp:C,eventType:F,new:{},old:{},errors:j}),this._getPayloadRecords(v))}m.callback(f,s)})}_isClosed(){return this.state===q.closed}_isJoined(){return this.state===q.joined}_isJoining(){return this.state===q.joining}_isLeaving(){return this.state===q.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&Yt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(H.close,{},e)}_onError(e){this._on(H.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=q.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Gs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Gs(e.columns,e.old_record)),t}}const Ci=()=>{},Ri=typeof WebSocket<"u",Ii=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class $i{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=wi,this.params={},this.timeout=Vs,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ci,this.conn=null,this.sendBuffer=[],this.serializer=new Ti,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>Promise.resolve().then(()=>Ne).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${Ht.websocket}`,this.httpEndpoint=Ws(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Js(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Ri){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Li(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Promise.resolve().then(()=>Wo).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ki}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case De.connecting:return _e.Connecting;case De.open:return _e.Open;case De.closing:return _e.Closing;default:return _e.Closed}}isConnected(){return this.connectionState()===_e.Open}channel(e,t={config:{}}){const s=new Yt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:n,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(H.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Si,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:a}=t;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(H.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Ii],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class Li{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=De.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class Qt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function D(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Ni extends Qt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Xt extends Qt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Di=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Xs=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ne).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Ui=()=>Di(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(()=>Ne)).Response:Response}),es=r=>{if(Array.isArray(r))return r.map(t=>es(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=es(s)}),e};var ve=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const ts=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Mi=(r,e,t)=>ve(void 0,void 0,void 0,function*(){const s=yield Ui();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new Ni(ts(n),r.status||500))}).catch(n=>{e(new Xt(ts(n),n))}):e(new Xt(ts(r),r))}),Bi=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function lt(r,e,t,s,n,i){return ve(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Bi(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Mi(c,o,s))})})}function St(r,e,t,s){return ve(this,void 0,void 0,function*(){return lt(r,"GET",e,t,s)})}function ce(r,e,t,s,n){return ve(this,void 0,void 0,function*(){return lt(r,"POST",e,s,n,t)})}function Fi(r,e,t,s,n){return ve(this,void 0,void 0,function*(){return lt(r,"PUT",e,s,n,t)})}function Zi(r,e,t,s){return ve(this,void 0,void 0,function*(){return lt(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function er(r,e,t,s,n){return ve(this,void 0,void 0,function*(){return lt(r,"DELETE",e,s,n,t)})}var Z=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const zi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},tr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class qi{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Xs(n)}uploadOrUpdate(e,t,s,n){return Z(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},tr),n);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),f=yield h.json();return h.ok?{data:{path:l,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(D(i))return{data:null,error:i};throw i}})}upload(e,t,s){return Z(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return Z(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:tr.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(D(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return Z(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield ce(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new Qt("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}})}update(e,t,s){return Z(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Z(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}copy(e,t,s){return Z(this,void 0,void 0,function*(){try{return{data:{path:(yield ce(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return Z(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield ce(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return Z(this,void 0,void 0,function*(){try{const n=yield ce(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}download(e,t){return Z(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield St(this.fetch,`${this.url}/${n}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(D(o))return{data:null,error:o};throw o}})}info(e){return Z(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield St(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:es(s),error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}})}exists(e){return Z(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Zi(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(D(s)&&s instanceof Xt){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${l}`)}}}remove(e){return Z(this,void 0,void 0,function*(){try{return{data:yield er(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}})}list(e,t,s){return Z(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},zi),t),{prefix:e||""});return{data:yield ce(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Vi={"X-Client-Info":"storage-js/2.7.1"};var Ue=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Ji{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Vi),t),this.fetch=Xs(s)}listBuckets(){return Ue(this,void 0,void 0,function*(){try{return{data:yield St(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(D(e))return{data:null,error:e};throw e}})}getBucket(e){return Ue(this,void 0,void 0,function*(){try{return{data:yield St(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ue(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Ue(this,void 0,void 0,function*(){try{return{data:yield Fi(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(D(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Ue(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ue(this,void 0,void 0,function*(){try{return{data:yield er(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}})}}class Gi extends Ji{constructor(e,t={},s){super(e,t,s)}from(e){return new qi(this.url,this.headers,e,this.fetch)}}const Hi="2.48.1";let ut="";typeof Deno<"u"?ut="deno":typeof document<"u"?ut="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ut="react-native":ut="node";const Wi={headers:{"X-Client-Info":`supabase-js-${ut}/${Hi}`}},Ki={schema:"public"},Yi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Qi={};var Xi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const ea=r=>{let e;return r?e=r:typeof fetch>"u"?e=Ps:e=fetch,(...t)=>e(...t)},ta=()=>typeof Headers>"u"?Cs:Headers,sa=(r,e,t)=>{const s=ea(t),n=ta();return(i,a)=>Xi(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:r;let l=new n(a==null?void 0:a.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},a),{headers:l}))})};var ra=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};function na(r){return r.replace(/\/$/,"")}function ia(r,e){const{db:t,auth:s,realtime:n,global:i}=r,{db:a,auth:o,realtime:c,global:l}=e,u={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},l),i),accessToken:()=>ra(this,void 0,void 0,function*(){return""})};return r.accessToken?u.accessToken=r.accessToken:delete u.accessToken,u}const sr="2.67.3",aa="http://localhost:9999",oa="supabase.auth.token",ca={"X-Client-Info":`gotrue-js/${sr}`},rr=10,ss="X-Supabase-Api-Version",nr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function la(r){return Math.round(Date.now()/1e3)+r}function ua(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const Q=()=>typeof window<"u"&&typeof document<"u",be={tested:!1,writable:!1},dt=()=>{if(!Q())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(be.tested)return be.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),be.tested=!0,be.writable=!0}catch{be.tested=!0,be.writable=!1}return be.writable};function da(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const ir=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ne).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},ha=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",ar=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Tt=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},xt=async(r,e)=>{await r.removeItem(e)};function fa(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,n,i,a,o,c,l,u=0;for(r=r.replace("-","+").replace("_","/");u<r.length;)a=e.indexOf(r.charAt(u++)),o=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),l=e.indexOf(r.charAt(u++)),s=a<<2|o>>4,n=(o&15)<<4|c>>2,i=(c&3)<<6|l,t=t+String.fromCharCode(s),c!=64&&n!=0&&(t=t+String.fromCharCode(n)),l!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Et{constructor(){this.promise=new Et.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Et.promiseConstructor=Promise;function or(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(fa(s))}async function pa(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function ma(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await r(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function ga(r){return("0"+r.toString(16)).substr(-2)}function ya(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,ga).join("")}async function _a(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}function va(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ba(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await _a(r);return va(t)}async function Me(r,e,t=!1){const s=ya();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await ar(r,`${e}-code-verifier`,n);const i=await ba(s);return[i,s===i?"plain":"s256"]}const wa=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ka(r){const e=r.headers.get(ss);if(!e||!e.match(wa))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class rs extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function x(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Sa extends rs{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Ta(r){return x(r)&&r.name==="AuthApiError"}class cr extends rs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class we extends rs{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class le extends we{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function xa(r){return x(r)&&r.name==="AuthSessionMissingError"}class ns extends we{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class At extends we{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ot extends we{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ea(r){return x(r)&&r.name==="AuthImplicitGrantRedirectError"}class lr extends we{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class is extends we{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function as(r){return x(r)&&r.name==="AuthRetryableFetchError"}class ur extends we{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var Aa=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const ke=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Oa=[502,503,504];async function dr(r){var e;if(!ha(r))throw new is(ke(r),0);if(Oa.includes(r.status))throw new is(ke(r),r.status);let t;try{t=await r.json()}catch(i){throw new cr(ke(i),i)}let s;const n=ka(r);if(n&&n.getTime()>=nr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new ur(ke(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new le}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new ur(ke(t),r.status,t.weak_password.reasons);throw new Sa(ke(t),r.status||500,s)}const ja=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function A(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[ss]||(i[ss]=nr["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await Pa(r,e,t+o,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Pa(r,e,t,s,n,i){const a=ja(e,s,n,i);let o;try{o=await r(t,Object.assign({},a))}catch(c){throw console.error(c),new is(ke(c),0)}if(o.ok||await dr(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(c){await dr(c)}}function ue(r){var e;let t=null;$a(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=la(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function hr(r){const e=ue(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function de(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Ca(r){return{data:r,error:null}}function Ra(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,a=Aa(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Ia(r){return r}function $a(r){return r.access_token&&r.refresh_token&&r.expires_in}var La=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class Na{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=ir(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await A(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await A(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:de})}catch(s){if(x(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=La(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await A(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Ra,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(x(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await A(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:de})}catch(t){if(x(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},u=await A(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Ia});if(u.error)throw u.error;const h=await u.json(),f=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(v=>{const E=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),k=JSON.parse(v.split(";")[1].split("=")[1]);l[`${k}Page`]=E}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(x(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await A(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:de})}catch(t){if(x(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await A(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:de})}catch(s){if(x(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await A(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:de})}catch(s){if(x(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await A(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(x(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await A(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}}}const Da={getItem:r=>dt()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{dt()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{dt()&&globalThis.localStorage.removeItem(r)}};function fr(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Ua(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Be={debug:!!(globalThis&&dt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class pr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ma extends pr{}async function Ba(r,e,t){Be.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Be.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Be.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{Be.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw Be.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Ma(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Be.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Ua();const Fa={url:aa,storageKey:oa,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ca,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},ht=30*1e3,mr=3;async function gr(r,e,t){return await t()}class ft{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ft.nextInstanceID,ft.nextInstanceID+=1,this.instanceID>0&&Q()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Fa),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Na({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=ir(n.fetch),this.lock=n.lock||gr,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Q()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ba:this.lock=gr,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:dt()?this.storage=Da:(this.memoryStorage={},this.storage=fr(this.memoryStorage)):(this.memoryStorage={},this.storage=fr(this.memoryStorage)),Q()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${sr}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=da(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Q()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Ea(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return x(t)?{error:t}:{error:new cr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:ue}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(x(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:u,password:h,options:f}=e;let m=null,v=null;this.flowType==="pkce"&&([m,v]=await Me(this.storage,this.storageKey)),i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:m,code_challenge_method:v},xform:ue})}else if("phone"in e){const{phone:u,password:h,options:f}=e;i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:ue})}else throw new At("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(x(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:hr})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:hr})}else throw new At("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new ns}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(x(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Tt(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:a}=await A(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ue});if(await xt(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new ns}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(x(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:a}=e,o=await A(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ue}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new ns}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(x(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,a;try{if("email"in e){const{email:o,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Me(this.storage,this.storageKey));const{error:h}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:u}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new At("You must provide either an email or phone number.")}catch(o){if(x(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await A(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:ue});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(n){if(x(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await Me(this.storage,this.storageKey)),await A(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Ca})}catch(i){if(x(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new le;const{error:n}=await A(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(x(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:a}=await A(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:a,error:o}=await A(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new At("You must provide either an email or phone number and a type")}catch(t){if(x(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Tt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!a&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:de}):await this._useSession(async t=>{var s,n,i;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new le}:await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:de})})}catch(t){if(x(t))return xa(t)&&(await this._removeSession(),await xt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new le;const a=n.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await Me(this.storage,this.storageKey));const{data:l,error:u}=await A(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:de});if(u)throw u;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(x(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return or(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new le;const t=Date.now()/1e3;let s=t,n=!0,i=null;const a=or(e.access_token);if(a.exp&&(s=a.exp,n=s<=t),n){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(x(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new le;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(x(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Q())throw new Ot("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ot(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new lr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ot("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new lr("No code detected.");const{data:F,error:j}=await this._exchangeCodeForSession(e.code);if(j)throw j;const $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:F.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=e;if(!i||!o||!a||!l)throw new Ot("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let f=u+h;c&&(f=parseInt(c));const m=f-u;m*1e3<=ht&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${h}s`);const v=f-h;u-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,f,u):u-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,f,u);const{data:E,error:k}=await this._getUser(i);if(k)throw k;const C={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:a,token_type:l,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:C,redirectType:e.type},error:null}}catch(s){if(x(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Tt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const a=(s=n.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Ta(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await xt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=ua(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Me(this.storage,this.storageKey,!0));try{return await A(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(x(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var a,o,c,l,u;const{data:h,error:f}=i;if(f)throw f;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await A(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return Q()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(x(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)throw a;return await A(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(x(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await ma(async n=>(n>0&&await pa(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await A(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ue})),(n,i)=>{const a=200*Math.pow(2,n);return i&&as(i)&&Date.now()+a-s<ht})}catch(s){if(this._debug(t,"error",s),x(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Q()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Tt(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=Math.round(Date.now()/1e3),i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<n+rr;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${rr}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),as(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new le;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Et;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new le;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),x(i)){const a={session:null,error:i};return as(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ar(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await xt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Q()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ht);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/ht);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${ht}ms, refresh threshold is ${mr} ticks`),n<=mr&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof pr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Q()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,a]=await Me(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await A(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(x(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await A(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(x(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(x(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(x(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(n.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}ft.nextInstanceID=0;const Za=ft;class za extends Za{constructor(e){super(e)}}var qa=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Va{constructor(e,t,s){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=na(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:Ki,realtime:Qi,auth:Object.assign(Object.assign({},Yi),{storageKey:c}),global:Wi},u=ia(s??{},l);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=sa(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new bi(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new oi(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Gi(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return qa(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:a,lock:o,debug:c},l,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new za({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:a,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new $i(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const os=((r,e,t)=>new Va(r,e,t))("https://hyeddbbdplkkwyokzqyl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5ZWRkYmJkcGxra3d5b2t6cXlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA5MDgyNjIsImV4cCI6MjA0NjQ4NDI2Mn0.6GTSsoyXHBTe8Bk5wfuI7cL3SpE7W4eJLIQ7t0v3uXE",{auth:{storage:{getItem:async r=>new Promise(e=>{chrome.storage.local.get([r],t=>{e(t[r]??null)})}),setItem:async(r,e)=>new Promise(t=>{chrome.storage.local.set({[r]:e},()=>{t()})}),removeItem:async r=>new Promise(e=>{chrome.storage.local.remove(r,()=>{e()})})},autoRefreshToken:!1,persistSession:!0,detectSessionInUrl:!0}});async function U({path:r,requestOptions:e,auth:t=!0,responseSchema:s}){if(e.headers={...e.headers,...e.body instanceof FormData?{}:{"Content-Type":"application/json"},"X-Ext-Version":chrome.runtime.getManifest().version,"X-Ext-Browser":"chrome"},t){const{data:{session:a},error:o}=await os.auth.getSession();if(o||!a)throw new Error("User not authenticated");e.headers={...e.headers,Authorization:`Bearer ${a.access_token}`}}const n=await fetch(`https://www.speedyapply.com${r}`,{...e,credentials:"include"});if(!n.ok)throw new Error(`Request failed: ${n.statusText}`);const i=await n.json();return s?s.parse(i):i}async function Ja({path:r,body:e,auth:t=!0}){var a;const s={"Content-Type":"application/json",Accept:"text/event-stream","X-Ext-Version":chrome.runtime.getManifest().version,"X-Ext-Browser":"chrome"};if(t){const{data:{session:o},error:c}=await os.auth.getSession();if(c||!o)throw new Error("User not authenticated");s.Authorization=`Bearer ${o.access_token}`}const n=await fetch(`https://www.speedyapply.com${r}`,{method:"POST",headers:s,body:JSON.stringify(e),credentials:"include"});if(!n.ok)throw new Error(`Request failed: ${n.statusText}`);const i=(a=n.body)==null?void 0:a.getReader();if(!i)throw new Error("No reader available");return i}async function L(){const{data:{session:r},error:e}=await os.auth.getSession();return e||!r?null:r}async function jt(){return new Promise(r=>chrome.storage.local.get(["appliedList"],e=>{try{r(qt.parse(e.appliedList))}catch(t){console.error(t),r([])}}))}async function Ga(){return new Promise(r=>chrome.storage.local.get(["lastSyncAppliedList"],e=>{try{r(d.string().datetime({offset:!0}).optional().parse(e.lastSyncAppliedList))}catch{r(void 0)}}))}const Ha=d.object({id:d.string().uuid(),profileName:d.string(),profile:nt,timestamp:d.string().datetime({offset:!0})}),Wa=d.object({description:d.string().optional(),title:d.string().optional(),manual:d.boolean().optional(),timestamp:d.string().datetime({offset:!0})}),yr=Symbol.for("constructDateFrom");function Ka(r,e){return typeof r=="function"?r(e):r&&typeof r=="object"&&yr in r?r[yr](e):r instanceof Date?new r.constructor(e):new Date(e)}function Ya(r,e){return Ka(r,r)}function he(r,e){const t=r<0?"-":"",s=Math.abs(r).toString().padStart(e,"0");return t+s}function _r(r,e){const t=Ya(r);if(isNaN(+t))throw new RangeError("Invalid time value");let s="",n="";const i="-",a=":";{const o=he(t.getDate(),2),c=he(t.getMonth()+1,2);s=`${he(t.getFullYear(),4)}${i}${c}${i}${o}`}{const o=t.getTimezoneOffset();if(o!==0){const m=Math.abs(o),v=he(Math.trunc(m/60),2),E=he(m%60,2);n=`${o<0?"+":"-"}${v}:${E}`}else n="Z";const c=he(t.getHours(),2),l=he(t.getMinutes(),2),u=he(t.getSeconds(),2),h=s===""?"":"T",f=[c,l,u].join(a);s=`${s}${h}${f}${n}`}return s}async function Qa(r,e,t){await chrome.storage.session.set({[`profile_${t}`]:{id:r,profileName:e.profileName,profile:e,timestamp:_r(new Date)}})}async function cs(r){return new Promise(e=>{chrome.storage.session.get([`profile_${r}`],t=>{try{e(Ha.parse(t[`profile_${r}`]))}catch{e(void 0)}})})}async function vr(r,e,t,s){await chrome.storage.session.set({[`job_${r}`]:{description:e,title:t,timestamp:_r(new Date),manual:s}})}async function Pt(r){return new Promise(e=>{chrome.storage.session.get([`job_${r}`],t=>{try{e(Wa.parse(t[`job_${r}`]))}catch{e(void 0)}})})}function ls(r){return chrome.storage.session.remove([`profile_${r}`,`job_${r}`])}async function Xa(){if(!await L())return;const[r,e]=await Promise.all([jt(),it()]),t=r.filter(a=>!a.id);if(t.length===0)return;const s=100,n=[];for(let a=0;a<t.length;a+=s){const o=t.slice(a,a+s),c=await U({path:"/api/ext/sync/application",requestOptions:{method:"POST",body:JSON.stringify(o.map(u=>({...u,profileId:e==null?void 0:e.id})))},responseSchema:zt.extend({id:d.string().uuid()}).array()}),l=o.map(u=>{const h=c.find(f=>f.jobTitle===u.jobTitle&&f.jobLink===u.jobLink&&f.companyLink===u.companyLink&&f.date.slice(0,15)===u.date.slice(0,15)&&f.profileName===u.profileName,u.id===void 0);return h?{...u,id:h.id}:u});n.push(...l)}const i=r.filter(a=>a.id);await chrome.storage.local.set({appliedList:[...n,...i]})}async function us(r){var F;const{jobTitle:e,jobLink:t,companyLink:s="",companyName:n="",appliedDate:i=new Date,duplicateCheck:a=!0,tabId:o,profileDetails:c}=r,l=o!==void 0?await cs(o):null,[u,h,f]=await Promise.all([l||c?null:Os(),jt(),o!==void 0?Pt(o):null]),m=e||(f==null?void 0:f.title)||"",v=(c==null?void 0:c.profileName)??(l==null?void 0:l.profile.profileName)??(u==null?void 0:u.profileName)??"Default";let E=!1;const k=i.toString();a&&(E=h.some(j=>j.jobTitle===m&&j.jobLink===t&&j.companyLink===s&&j.date.slice(0,15)===k.slice(0,15)&&j.profileName===v));const C={jobTitle:m,jobLink:t,companyLink:s,companyName:n,date:k,status:"applied",profileName:v};if(!E){if(h.unshift(C),await chrome.storage.local.set({appliedList:h}),await L()){const j=(c==null?void 0:c.id)??(l==null?void 0:l.id)??((F=await it())==null?void 0:F.id),{id:$}=await U({path:"/api/ext/sync/application",requestOptions:{method:"POST",body:JSON.stringify({profileId:j,...C})},responseSchema:d.object({id:d.string().uuid()})}),R=await jt(),fe=R.findIndex(Fe=>Fe.jobTitle===C.jobTitle&&Fe.jobLink===C.jobLink&&Fe.companyLink===C.companyLink&&Fe.date.slice(0,15)===C.date.slice(0,15)&&Fe.profileName===C.profileName&&Fe.id===void 0);fe!==-1&&(R[fe]={...R[fe],id:$},await chrome.storage.local.set({appliedList:R}))}o!==void 0&&await ls(o)}}async function eo(r){!await L()||!r.id||await U({path:"/api/ext/sync/application",requestOptions:{method:"PUT",body:JSON.stringify(r)}})}async function to(r){!await L()||!r||await U({path:`/api/ext/sync/application?id=${encodeURIComponent(r)}`,requestOptions:{method:"DELETE"}})}async function so(){if(!await L())return[];const r=await Ga(),e=new URLSearchParams;r&&e.set("last_sync",r);const{applications:t,last_sync:s,deleted_ids:n}=await U({path:`/api/ext/sync/application?${e.toString()}`,requestOptions:{method:"GET"},responseSchema:d.object({applications:zt.extend({id:d.string().uuid()}).array(),deleted_ids:d.string().uuid().array(),last_sync:d.string().datetime({offset:!0}).optional()})});if(t.length===0&&n.length===0)return[];const i=await jt(),a=t.filter(l=>!i.some(u=>u.id===l.id)),o=i.map(l=>{const u=t.find(h=>h.id===l.id);return u?{...l,...u}:l}),c=[...a,...o].filter(l=>l.id&&!n.includes(l.id));return await chrome.storage.local.set({appliedList:c}),s&&await chrome.storage.local.set({lastSyncAppliedList:s}),c}async function Ct(){return new Promise(r=>{chrome.storage.local.get(["responseList"],e=>{try{r(Bn.parse(e.responseList))}catch(t){console.error(t),r([])}})})}async function ro(){return new Promise(r=>{chrome.storage.local.get(["lastSyncResponseList"],e=>{try{r(d.string().datetime({offset:!0}).optional().parse(e.lastSyncResponseList))}catch{r(void 0)}})})}function no(r){const e=r.match(/\b\w+\b/g),t=e?new Set(e.map(s=>s.toLowerCase()).filter(s=>(s.length>1||!isNaN(Number(s)))&&!io.includes(s))):new Set;return Array.from(t)}const io=["am","an","as","at","be","by","co","do","eg","et","ex","go","he","hi","ie","if","in","is","it","me","mr","my","nd","of","oh","ok","on","or","qv","rd","re","so","th","to","un","up","us","vs","we"];async function ao(r){const e=await Ct(),t={};for(const i of e)t[i.key]=i;const s=[],n=[];for(const{question:i,response:a}of r){if(/^(select|choose|please select|\-\-)(\s(all|one))?\.*$/i.test(a))continue;const o=no(i);if(!o.length)continue;const c=o.sort().join("|"),l=t[c];if(l)l.response=a,l.fromAutofill=!0,n.push(l);else{const u={keywords:o,key:c,appearances:o.length,response:a,fromAutofill:!0,question:i};e.push(u),t[c]=u,s.push(u)}}await chrome.storage.local.set({responseList:e}),await Rt(s),await br(n)}async function Rt(r){if(!await L())return;const e=r===void 0?await Ct():r,t=e.filter(i=>!i.id);if(t.length===0)return;const s=100,n=[];for(let i=0;i<t.length;i+=s){const a=t.slice(i,i+s),o=await U({path:"/api/ext/sync/response",requestOptions:{method:"POST",body:JSON.stringify(a)},responseSchema:d.object({id:d.string().uuid(),key:d.string()}).array()}),c=a.map(l=>{const u=o.find(h=>h.key===l.key&&l.id===void 0);return u?{...l,id:u.id}:l});n.push(...c)}if(r===void 0){const i=e.filter(a=>a.id);await chrome.storage.local.set({responseList:[...n,...i]})}else{const a=(await Ct()).map(o=>{const c=n.find(l=>l.key===o.key);return c?{...o,...c}:o});await chrome.storage.local.set({responseList:a})}}async function br(r){const e=r.filter(t=>typeof t.id=="string");!await L()||e.length===0||await U({path:"/api/ext/sync/response",requestOptions:{method:"PUT",body:JSON.stringify(e)}})}async function oo(r){!await L()||!r||await U({path:`/api/ext/sync/response?id=${encodeURIComponent(r)}`,requestOptions:{method:"DELETE"}})}async function wr(){await L()&&await U({path:"/api/ext/sync/response?delete_all=true",requestOptions:{method:"DELETE"}})}async function co(r){await wr(),await Rt(r)}async function lo(){if(!await L())return[];const r=await ro(),e=new URLSearchParams;r&&e.set("last_sync",r);const{responses:t,last_sync:s,deleted_ids:n}=await U({path:`/api/ext/sync/response?${e.toString()}`,requestOptions:{method:"GET"},responseSchema:d.object({responses:Ft.extend({id:d.string().uuid()}).array(),deleted_ids:d.string().uuid().array(),last_sync:d.string().datetime({offset:!0}).optional()})});if(t.length===0&&n.length===0)return[];const i=await Ct(),a=t.filter(l=>!i.some(u=>u.id===l.id)),o=i.map(l=>{const u=t.find(h=>h.id===l.id);return u?{...l,...u}:l}),c=[...a,...o].filter(l=>l.id&&!n.includes(l.id));return await chrome.storage.local.set({responseList:c}),s&&await chrome.storage.local.set({lastSyncResponseList:s}),c}const re={configName:"Default",autofillSettings:{saveApplications:!0,autoClickNextPage:!1,autoSubmit:!1,saveResponses:!0}},It={accountEmail:"",accountPassword:"",useProfileEmail:!1};async function uo(r){const e=qt.safeParse(r.newValue),t=qt.safeParse(r.oldValue);if(!e.success||!t.success||e.data.length===t.data.length)return;const s=await chrome.tabs.query({url:["*://github.com/speedyapply/2025-SWE-College-Jobs*","*://github.com/speedyapply/2025-AI-College-Jobs*","*://github.com/speedyapply/2026-SWE-College-Jobs*","*://github.com/speedyapply/2026-AI-College-Jobs*"]});for(const n of s)try{n.id!==void 0&&await chrome.tabs.sendMessage(n.id,{action:"runAddCheckmarks"})}catch{console.log(`Error sending message to tab ${n.id}:`)}}async function ho(){const[r,e]=await Promise.all([Sr(),new Promise(t=>{chrome.storage.local.get(["profile"],s=>t(nt.safeParse(s.profile).success))})]);!r&&e&&await kr()}async function kr(){const[r,e]=await Promise.all([Os(),it()]);if(!await L()||!r)return;const{id:t,last_sync:s}=await U({path:"/api/ext/sync/profile",requestOptions:{method:"POST",body:JSON.stringify({id:e==null?void 0:e.id,profile:r})},responseSchema:d.object({id:d.string().uuid(),last_sync:d.string().datetime({offset:!0})})});await chrome.storage.local.set({lastSyncProfile:{id:t,lastSync:s}})}async function Sr(r,e=!0){if(!await L())return null;const t=new URLSearchParams;if(r)t.set("id",r);else{const n=await it();n!=null&&n.id&&t.set("id",n.id),n!=null&&n.lastSync&&t.set("last_sync",n.lastSync)}const s=await U({path:`/api/ext/sync/profile?${t.toString()}`,requestOptions:{method:"GET"},responseSchema:d.union([d.object({profile:nt,id:d.string().uuid(),last_sync:d.string().datetime({offset:!0})}),d.object({}).strict()])});return"profile"in s?(e&&await chrome.storage.local.set({profile:s.profile,lastSyncProfile:{id:s.id,lastSync:s.last_sync}}),s.profile):null}async function fo(){return await L()?U({path:"/api/ext/sync/profile/list",requestOptions:{method:"GET"},responseSchema:d.object({id:d.string().uuid(),profileName:d.string()}).array()}):null}const ds=d.object({accountEmail:d.string().trim(),accountPassword:d.string().trim(),useProfileEmail:d.boolean()}),po=d.object({responseContext:d.string().max(5e3).optional()}),mo=d.object({saveApplications:d.boolean(),autoClickNextPage:d.boolean(),autoSubmit:d.boolean(),saveResponses:d.preprocess(r=>r===void 0?!0:r,d.boolean())}),Tr=d.object({configName:d.string().optional(),autofillSettings:mo,premiumSettings:po.optional(),accountSettings:d.preprocess(r=>{const e=ds.extend({useProfileEmail:d.boolean().optional()}).safeParse(r);e.success&&chrome.storage.local.set({autofillAccount:{...e.data,useProfileEmail:e.data.useProfileEmail??!1}})},d.undefined())}),xr=d.array(Tr.extend({configName:d.string()})),go=d.number().min(1).max(999);async function hs(){return new Promise(r=>{chrome.storage.local.get(["settings","configList"],e=>{try{r({settings:Tr.parse(e.settings),configList:xr.parse(e.configList)})}catch(t){console.error(t),chrome.storage.local.set({settings:re,configList:[re]}),r({settings:re,configList:[re]})}})})}async function yo(){return new Promise(r=>{chrome.storage.local.get(["dailyGoal"],e=>{try{r(go.parse(e.dailyGoal))}catch(t){console.error(t),chrome.storage.local.set({dailyGoal:10}).then(()=>r(10))}})})}async function Er(){return new Promise(r=>{chrome.storage.local.get(["autofillAccount"],e=>{try{r(ds.parse(e.autofillAccount))}catch(t){console.error(t),chrome.storage.local.set({autofillAccount:It}).then(()=>r(It))}})})}async function _o(){return new Promise(r=>{chrome.storage.local.get(["autofillEnabled"],e=>{try{r(d.boolean().parse(e.autofillEnabled))}catch(t){console.error(t),chrome.storage.local.set({autofillEnabled:!0}).then(()=>r(!0))}})})}async function Ar(){return new Promise(r=>{chrome.storage.local.get(["lastSyncSettings"],e=>{try{r(d.object({id:d.string().uuid(),lastSync:d.string().datetime({offset:!0})}).optional().parse(e.lastSyncSettings))}catch{r(void 0)}})})}async function vo(){if(!await L())return;await bo()||await Or()}async function Or(){if(!await L())return;const[r,e,t,s]=await Promise.all([hs(),yo(),Er(),Ar()]),{id:n,last_sync:i}=await U({path:"/api/ext/sync/settings",requestOptions:{method:"POST",body:JSON.stringify({id:s==null?void 0:s.id,config_list:r.configList,active_config:r.settings.configName??"Default",daily_goal:e,autofill_account:t})},responseSchema:d.object({id:d.string().uuid(),last_sync:d.string().datetime({offset:!0})})});await chrome.storage.local.set({lastSyncSettings:{id:n,lastSync:i}})}async function bo(){if(!await L())return null;const r=await Ar(),e=new URLSearchParams;r!=null&&r.id&&e.set("id",r.id),r!=null&&r.lastSync&&e.set("last_sync",r.lastSync);const t=await U({path:`/api/ext/sync/settings?${e.toString()}`,requestOptions:{method:"GET"},responseSchema:d.union([d.object({config_list:xr,daily_goal:d.number(),active_config:d.string(),autofill_account:ds,id:d.string().uuid(),last_sync:d.string().datetime({offset:!0})}),d.object({}).strict()])});if("config_list"in t){const s=t.config_list.find(n=>n.configName===t.active_config)??re;return await chrome.storage.local.set({configList:t.config_list,settings:s,dailyGoal:t.daily_goal,autofillAccount:t.autofill_account,lastSyncSettings:{id:t.id,lastSync:t.last_sync}}),t.config_list}return null}async function wo(r){const e=r.oldValue!==null&&r.oldValue!==void 0,t=r.newValue!==null&&r.newValue!==void 0;!e&&t?(chrome.runtime.sendMessage({type:"userLoggedIn"}),await ho(),await Promise.all([Xa(),Rt(),vo()]),await Promise.all([so(),lo()]),await chrome.storage.local.set({initialSyncComplete:!0})):e&&!t&&chrome.storage.local.clear(()=>{chrome.storage.local.set({autofillEnabled:!0,settings:re,configList:[re],autofillAccount:It,appliedList:[],responseList:[],dailyGoal:10,initialSyncComplete:!1})})}const jr=d.object({maxProfiles:d.number(),premiumAutofill:d.boolean()}),ko=d.enum(["active","trialing","past_due","canceled","unpaid","incomplete","incomplete_expired","paused"]),So=d.object({interval:d.string(),interval_count:d.number(),price_amount:d.number().nullable()}),To=d.object({account_id:d.string().uuid(),status:ko.optional(),active:d.boolean(),period_starts_at:d.string(),period_ends_at:d.string(),trial_starts_at:d.string().nullable(),trial_ends_at:d.string().nullable(),items:d.array(So)}),xo=d.enum(["week","month","quarter","year"]),Eo=d.enum(["flat"]),Ao=d.enum(["recurring"]),Oo=d.object({id:d.string().min(1),name:d.string().min(1),description:d.string().optional(),cost:d.number().min(0),type:Eo}),jo=d.object({id:d.string().min(1),name:d.string().min(1),interval:xo.optional(),lineItems:d.array(Oo).refine(r=>r.map(s=>s.type).filter(s=>s==="flat").length<=1,{message:"Plans can only have one flat line item",path:["lineItems"]}),trialDays:d.number({description:"Number of days for the trial period. Leave empty for no trial."}).positive().optional(),badge:d.string({description:"Badge for the plan. Displayed to the user."}).optional(),paymentType:Ao}).refine(r=>r.lineItems.length>0,{message:"Plans must have at least one line item",path:["lineItems"]}).refine(r=>r.paymentType!=="recurring"||r.interval!==void 0,{message:"Recurring plans must have an interval",path:["paymentType","interval"]}).refine(r=>{const e=r.lineItems.map(t=>t.id);return e.length===new Set(e).size},{message:"Line item IDs must be unique",path:["lineItems"]}),Po=d.object({id:d.string().min(1),name:d.string().min(1),plans:d.array(jo)}).refine(r=>r.plans.length>0,{message:"Products must have at least one plan",path:["plans"]}).refine(r=>{const e=r.plans.map(t=>t.id);return e.length===new Set(e).size},{message:"Plan IDs must be unique",path:["plans"]}),Pr=d.union([d.object({existing:d.boolean(),subscription:To,limits:jr}),d.object({existing:d.boolean(),subscription:d.null(),product:Po,limits:jr})]),Co=d.object({data:Pr.nullable(),timestamp:d.number()});async function Ro(){return new Promise(r=>{chrome.storage.local.get("subscription",e=>{const t=Co.safeParse(e.subscription);if(!t.success){r(null);return}const s=Date.now()-t.data.timestamp>2*60*60*1e3;r(s?null:t.data.data)})})}async function Io(r){await chrome.storage.local.set({subscription:{data:r,timestamp:Date.now()}})}async function $o(r=!0){if(!await L())return null;const e=r?await Ro():null;if(e)return e;const t=await U({path:"/api/ext/subscription",requestOptions:{method:"GET"},responseSchema:Pr});return await Io(t),t}async function Lo(){const[{settings:r},e,t,s,n]=await Promise.all([hs(),Er(),_o(),new Promise(i=>{chrome.storage.local.get(["profile"],a=>i(nt.safeParse(a.profile).success))}),$o()]);return{autofillSettings:r.autofillSettings,accountSettings:e,enabled:t,premium:!!(n!=null&&n.limits.premiumAutofill),hasProfile:s}}async function No(r,e){if(!await L())return null;const t=r!==void 0?await Pt(r):void 0;return U({path:"/api/ext/autofill/scores",requestOptions:{method:"POST",body:JSON.stringify({job_title:t==null?void 0:t.title,job_description:t==null?void 0:t.description,application_url:e,manual:t==null?void 0:t.manual})},responseSchema:d.discriminatedUnion("scores",[d.object({scores:d.literal(!0),profiles:d.object({id:d.string().uuid(),profileName:d.string(),score:d.number(),matchReason:d.string(),highlights:d.string().array(),signals:d.object({skillsMatched:d.number(),skillsTotal:d.number(),titleSimilarity:d.number(),yearsOfExperience:d.number(),matchingSkills:d.string().array(),requiredYearsOfExperience:d.number().nullable()})}).array()}),d.object({scores:d.literal(!1),profiles:d.object({id:d.string().uuid(),profileName:d.string()}).array()})])})}async function Do(r,e,t,s,n){var v;if(!await L())return null;const[i,a,o,{settings:c}]=await Promise.all([cs(t),it(),Pt(t),hs()]),l=(i==null?void 0:i.id)||(a==null?void 0:a.id);if(!l)throw new Error("No profile ID available to generate response.");const u=await Ja({path:"/api/ext/autofill/response",body:{profile_id:l,prompt:r,additional_context:e,job_description:o==null?void 0:o.description,job_title:o==null?void 0:o.title,application_url:s,response_context:(v=c.premiumSettings)==null?void 0:v.responseContext}}),h=new TextDecoder;let f="",m="";for(;;){const{done:E,value:k}=await u.read();if(E)break;const F=h.decode(k).split(`
`).filter(j=>j.trim());for(const j of F){const $=j.match(/^0:"(.+?)"$/);if($){const fe=$[1].replace(/\\n/g,`
`).replace(/\\/g,"");f+=fe,n(f)}const R=j.match(/^2:(\[.+\])$/);if(R){const fe=d.tuple([d.object({responseId:d.string()})]).safeParse(JSON.parse(R[1]));fe.success&&(m=fe.data[0].responseId)}}}if(!m)throw new Error("No responseId returned from server.");return{text:f,responseId:m}}async function Uo(r,e,t,s){return await L()?U({path:"/api/ext/autofill/response/feedback",requestOptions:{method:"POST",body:JSON.stringify({response_id:r,is_positive:e,selected_reasons:t,details:s})}}):null}function Se(r,e){r().then(e).catch(t=>e({error:(t==null?void 0:t.message)||"An error occurred"}))}function Mo(){chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({id:"link-save-application",title:"Save Link as Application",contexts:["link"]}),chrome.contextMenus.create({id:"page-save-application",title:"Save Page as Application",contexts:["page"]})})}async function Bo(r){try{const e=r.linkUrl;if(!e)throw new Error("No link URL found");const n=(await(await fetch(e)).text()).match(/<title.*?>(.*?)<\/title>/i),i=n?n[1]:"",a=new URL(e).origin;await us({jobTitle:i,jobLink:e,companyLink:a})}catch(e){console.error("Error fetching page content:",e)}}async function Fo(r,e){await us({jobTitle:(e==null?void 0:e.title)??"",jobLink:r.pageUrl})}const Zo=[{direction:"toTopFrame",from:"autofill.requestProfile",to:"autofill.requestProfile.relay",payload:(r,e,t)=>({frameId:e,appUrl:t})},{direction:"toIframe",from:"autofill.provideProfile",to:"autofill.provideProfile.relay",payload:r=>({profile:r.profile})},{direction:"toTopFrame",from:"autofill.statusUpdate",to:"autofill.statusUpdate.relay",payload:r=>({message:r.message})},{direction:"toTopFrame",from:"modal.show",to:"modal.show.relay",payload:r=>({message:r.message})},{direction:"toTopFrame",from:"modal.close",to:"modal.close.relay",payload:()=>({})},{direction:"toTopFrame",from:"timedModal.show",to:"timedModal.show.relay",payload:r=>({message:r.message,duration:r.duration})},{direction:"toTopFrame",from:"feedback.showDialog",to:"feedback.showDialog.relay",payload:(r,e)=>({sourceFrameId:e})},{direction:"toIframe",from:"feedback.submit",to:"feedback.submit.relay",payload:r=>({selectedReasons:r.selectedReasons,details:r.details})}];function zo(r,e){var n;const t=Zo.find(i=>i.from===r.type);if(!t)return!1;const s=(n=e.tab)==null?void 0:n.id;if(!s)return!0;if(t.direction==="toTopFrame"){if(e.frameId===0||!e.url)return!0;const i=t.payload(r,e.frameId,e.url);chrome.tabs.sendMessage(s,{type:t.to,...i},{frameId:0})}else{const i=r.frameId;if(!i)return!0;const a=t.payload(r);chrome.tabs.sendMessage(s,{type:t.to,...a},{frameId:i})}return!0}const qo=$r(()=>{chrome.runtime.onInstalled.addListener(async r=>{if(r.reason===chrome.runtime.OnInstalledReason.INSTALL){chrome.runtime.setUninstallURL("https://www.speedyapply.com/uninstall");const e=chrome.runtime.getURL("/options.html#/edit");await chrome.tabs.create({url:e}),chrome.storage.local.set({autofillEnabled:!0,settings:re,configList:[re],autofillAccount:It,appliedList:[],responseList:[],dailyGoal:10,initialSyncComplete:!1})}else if(r.reason===chrome.runtime.OnInstalledReason.UPDATE){const e=await chrome.storage.local.get(),t=Object.keys(e).find(s=>s.startsWith("sb-")&&s.endsWith("-auth-token"));await chrome.storage.local.set({initialSyncComplete:!!t&&!!e[t]})}Mo()}),chrome.storage.onChanged.addListener(async function(r,e){const t=Object.keys(r).find(s=>s.startsWith("sb-")&&s.endsWith("-auth-token"));if(e==="local"&&t){await wo(r[t]);return}else if(e==="local"&&r.appliedList){uo(r.appliedList);return}}),chrome.runtime.onMessage.addListener((r,e,t)=>{var n;const s=(n=e.tab)==null?void 0:n.id;if(zo(r,e))return!0;switch(r.type){case"saveApplication":us({jobTitle:r.jobTitle,jobLink:r.jobLink,companyLink:r.companyLink,companyName:r.companyName,appliedDate:r.appliedDate,duplicateCheck:r.duplicateCheck,tabId:s});break;case"syncUpdatedApplication":eo(r.data);break;case"syncDeletedApplication":to(r.data);break;case"saveResponses":ao(r.data);break;case"syncNewResponses":Rt(r.data);break;case"syncUpdatedResponses":br(r.data);break;case"syncDeletedResponse":oo(r.data);break;case"syncDeleteAllResponses":wr();break;case"overwriteResponses":co(r.data);break;case"syncProfile":Se(kr,t);break;case"syncSettings":Or();break;case"getAutofillConfig":Se(Lo,t);break;case"premiumFetchJobScores":{s!==void 0&&Se(()=>No(s,r.appUrl),t);break}case"premiumFetchProfileList":Se(fo,t);break;case"setSelectedProfile":Se(async()=>{const a=await Sr(r.profileId,!1);return a&&a.profileName&&r.profileId&&s!==void 0&&await Qa(r.profileId,a,s),a},t);break;case"getSelectedProfile":s!==void 0&&Se(()=>cs(s),t);break;case"storeJobDetails":s!==void 0&&Se(()=>vr(s,r.description,r.title,r.manual),t);break;case"clearJobDetails":s!==void 0&&ls(s);break;case"openOptionsFeedback":const i=chrome.runtime.getURL(`/options.html#/?feedback=true&link=${encodeURIComponent(r.currentUrl)}`);chrome.tabs.create({url:i});break;case"openOptionsProfilePage":chrome.tabs.create({url:chrome.runtime.getURL("/options.html#/profile")});break;case"premiumResponseFeedback":Uo(r.responseId,r.isPositive,r.selectedReasons,r.details);break;default:console.warn(`Unhandled message type: ${r.type}`)}return!0}),chrome.tabs.onCreated.addListener(async r=>{if(r.id&&r.openerTabId){const e=await Pt(r.openerTabId);e&&await vr(r.id,e.description,e.title,e.manual)}}),chrome.tabs.onRemoved.addListener(ls),chrome.contextMenus.onClicked.addListener(async(r,e)=>{switch(r.menuItemId){case"link-save-application":await Bo(r);break;case"page-save-application":await Fo(r,e);break;default:console.warn(`Unhandled menu item: ${r.menuItemId}`)}}),chrome.runtime.onConnect.addListener(r=>{var s,n,i,a;const e=(n=(s=r.sender)==null?void 0:s.tab)==null?void 0:n.id,t=(a=(i=r.sender)==null?void 0:i.tab)==null?void 0:a.url;r.name==="generate-response"&&r.onMessage.addListener(async o=>{if(o.type==="GENERATE_RESPONSE"){if(!e||!t||!o.prompt){r.postMessage({type:"STREAM_ERROR",error:"No tab ID, URL, or prompt available"});return}try{const c=await Do(o.prompt,o.additionalContext,e,t,l=>r.postMessage({type:"STREAM_UPDATE",text:l}));if(!(c!=null&&c.responseId))throw new Error("No responseId returned from server.");r.postMessage({type:"STREAM_END",responseId:c.responseId})}catch(c){r.postMessage({type:"STREAM_ERROR",error:c instanceof Error?c.message:String(c)})}}})})});function dc(){}(Ir=(Rr=globalThis.browser)==null?void 0:Rr.runtime)!=null&&Ir.id?globalThis.browser:globalThis.chrome;function $t(r,...e){}const Vo={debug:(...r)=>$t(console.debug,...r),log:(...r)=>$t(console.log,...r),warn:(...r)=>$t(console.warn,...r),error:(...r)=>$t(console.error,...r)};let fs;try{fs=qo.main(),fs instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw Vo.error("The background crashed on startup!"),r}const Jo=fs;var ps,Cr;function Go(){return Cr||(Cr=1,ps=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),ps}var Ho=Go();const Wo=Object.freeze(Object.defineProperty({__proto__:null,default:js(Ho)},Symbol.toStringTag,{value:"Module"}));return Jo}();
background;
